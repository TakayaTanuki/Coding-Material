<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <title>じゃんけん！！</title>
    <link rel="stylesheet" href="..\css\janken.css">
    <script src="..\javascript\janken.js"></script>
</head>

<body>
    <!--1段落目(メッセージ表示)-->
    <!--Divタグにもclassやidを付与できるため、後ほど行うかも？？-->
    <div class="inputUserName">
        <form action="javascript:void(0)" name="inputName">
            <h3>プレイヤー名を入力し、対戦相手を選択して下さい。</h3>
            <input type="text" name="inputPlayerName">
            <select id="opponent" name="opponent">
                <option value="">選択してください。</option>
                <option value="原田 邦彦">原田 邦彦</option>
                <option value="土井 健">土井 健</option>
            </select>
            <input type="submit" value="OK" name="submit" onclick="changeMessage('none');">
        </form>
    </div>

    <div class="messageWindow">
        <span class="totalCountMessage">
            <h5>じゃんけんは全部で5回勝負！</h5>
        </span>
        <span class="battleMessage">
            <h5><span id="disp_count">1</span>回目の対戦だ！グー、チョキ、パーの中から選んでね！</h5>
        </span>
    </div>

    <br>

    <!--2段落目(じゃんけんの画像選択)-->
    <div class="battleWindow">
        <!--できたら2,3段落目は最初非表示、名前が入力されたら表示できるようにする-->
        <div class="selectCommand">
            <!--グーコマンド-->
            <span class="guhParagraph">
                <h5>グー</h5>
                <a href="#" onclick="selectGuh();">
                    <img src="..\image\guh.jpg" id="guh">
                </a>
            </span>

            <!--チョキコマンド-->
            <span class="chokiParagraph">
                <h5>チョキ</h5>
                <a href="#" onclick="selectChoki();">
                    <img src="..\image\choki.jpg" id="choki">
                </a>
            </span>

            <!--パーコマンド-->
            <span class="pahParagraph">
                <h5>パー</h5>
                <a href="#" onclick="selectPah();">
                    <img src="..\image\pah.jpg" id="pah">
                </a>
            </span>
        </div>

        <!--3段落目(Result表示)-->
        <div class="resultTable">
            <h5>戦績</h5>
            <table border="1" align="center">
                <!--Player名列-->
                <tr>
                    <td class="numberColumn"></td>
                    <td class="playerName"></td>
                    <!--<span class="playerName"></span>でも同じ-->
                    <td class="opponent"></td>
                </tr>
                <!--1戦目-->
                <tr>
                    <td>1</td>
                    <td class="playerFirstResult"></td>
                    <td class="opponentFirstResult"></td>
                </tr>
                <!--2戦目-->
                <tr>
                    <td>2</td>
                    <td class="playerSecondResult"></td>
                    <td class="opponentSecondResult"></td>
                </tr>
                <!--3戦目-->
                <tr>
                    <td>3</td>
                    <td class="playerThirdResult"></td>
                    <td class="opponentThirdResult"></td>
                </tr>
                <!--4戦目-->
                <tr>
                    <td>4</td>
                    <td class="playerFourthResult"></td>
                    <td class="opponentFourthResult"></td>
                </tr>
                <!--5戦目-->
                <tr>
                    <td>5</td>
                    <td class="playerFifthResult"></td>
                    <td class="opponentFifthResult"></td>
                </tr>
                <!--勝敗-->
                <tr>
                    <td>結果</td>
                    <td class="playerFinalResult"></td>
                    <td class="opponentFinalResult"></td>
                </tr>
            </table>
        </div>
    </div>
</body>

</html>


let disp;
let messageDisp;

function changeMessage(disp) {
    const playerName = inputName.inputPlayerName.value;
    const opponent = inputName.opponent.value;
    //playerName == ''
    //空文字の判定
    if (!playerName) {
        disp = 'block';
    } else {
        messageDisp = 'block'
    }

    //Player名をセットする
    //html要素.innerText='~~'でhtmlの要素を上書きできる。
    document.querySelector('.playerName').innerText = playerName;

    //対戦相手名をセットする
    document.querySelector('.opponent').innerText = opponent;

    //div(inputUserName)を非表示に
    document.querySelector('.inputUserName').style.display = disp;
    //div(messageWindow)を表示
    document.querySelector('.messageWindow').style.display = messageDisp;
    //div(battleWindow)を表示
    document.querySelector('.battleWindow').style.display = messageDisp;
}

//let guh = document.getElementById('guh');
//guh.addEventListener('click', selectGuh);

function selectGuh() {
    const playderHand = 'guh';
    const battleResult = battle(playderHand);
}

function selectChoki() {
    const playderHand = 'choki';
    const battleResult = battle(playderHand);

}

function selectPah() {
    const playderHand = 'pah';
    const battleResult = battle(playderHand);
}

let countValue = 1;
let evenCount = 0;

function battle(playderHand) {
    //じゃんけんの手を配列にセットする
    const arrayOpponentHand = ['guh', 'choki', 'pah'];
    //じゃんけんの手をランダムに選択する
    //const opponentHand = arrayOpponentHand[Math.floor(Math.random() * arrayOpponentHand.length)];
    const opponentHand = 'choki';
    //じゃんけんの回数を求めるための準備
    const countDisp = document.getElementById('disp_count');
    //カウントアップしない回数を取得
    const beforeCountUpDisp = countDisp.textContent;
    countValue += 1;

    //じゃんけんの回数が6以上になった場合、終了するように設定。
    if (countValue - evenCount >= 6) {
        alert('終了');
        //<span class="battleMessage">をdisplay:noen。
    } else {
        //じゃんけんの回数が1~5回までの場合、htmlの回数を上書き
        countDisp.innerHTML = countValue - evenCount;
        switch (playderHand) {
            case 'guh':
                if (opponentHand == 'guh') {
                    alert('相手の手はグーだ！結果はあいこだ！');
                    //あいこになった回数として1加算
                    evenCount++;
                    countDisp.innerHTML = countValue - evenCount;
                } else if (opponentHand == 'choki') {
                    alert('相手の手はチョキだ！結果は勝ちだ！');
                    console.log(beforeCountUpDisp - evenCount);
                    writeWinResultAtPlayer(beforeCountUpDisp - evenCount);
                } else if (opponentHand == 'pah') {
                    alert('相手の手はパーだ！結果は負けだ...');
                    writeWinResultAtOpponent(countValue - evenCount);
                } else {
                    alert('不正な勝負です。')
                }
                break;

            case 'choki':
                if (opponentHand == 'guh') {
                    alert('相手の手はグーだ！結果は負けだ...');
                    writeWinResultAtOpponent(countValue - evenCount);
                } else if (opponentHand == 'choki') {
                    alert('相手の手はチョキだ！結果はあいこだ！');
                    //あいこになった回数として1加算
                    evenCount++;
                    countDisp.innerHTML = countValue - evenCount;
                } else if (opponentHand == 'pah') {
                    alert('相手の手はパーだ！結果は勝ちだ！');
                    writeWinResultAtPlayer(countValue - evenCount);
                } else {
                    alert('不正な勝負です。')
                }
                break;
            case 'pah':
                if (opponentHand == 'guh') {
                    alert('相手の手はグーだ！結果は勝ちだ！');
                    writeWinResultAtPlayer(countValue - evenCount);
                } else if (opponentHand == 'choki') {
                    alert('相手の手はチョキだ！結果は負けだ...');
                    writeWinResultAtOpponent(countValue - evenCount);
                } else if (opponentHand == 'pah') {
                    alert('相手の手はパーだ！結果はあいこだ！');
                    //あいこになった回数として1加算
                    evenCount++;
                    countDisp.innerHTML = countValue - evenCount;
                } else {
                    alert('不正な勝負です。')
                }
                break;
        }

    }



}

const winMessage = '○';

function writeWinResultAtPlayer(normalCount) {
    switch (normalCount) {
        case 1:
            document.querySelector('.playerFirstResult').innerHTML = winMessage;
            break;
        case 2:
            document.querySelector('.playerSecondResult').innerHTML = winMessage;
            break;
        case 3:
            document.querySelector('.playerThirdResult').innerHTML = winMessage;
            break;
        case 4:
            document.querySelector('.playerFourthResult').innerHTML = winMessage;
            break;
        case 5:
            document.querySelector('.playerFifthResult').innerHTML = winMessage;
            break;
    }
}

function writeWinResultAtOpponent(normalCount) {
    switch (normalCount) {
        case 1:
            document.querySelector('.opponentFirstResult').innerHTML = winMessage;
            break;
        case 2:
            document.querySelector('.opponentSecondResult').innerHTML = winMessage;
            break;
        case 3:
            document.querySelector('.opponentThirdResult').innerHTML = winMessage;
            break;
        case 4:
            document.querySelector('.opponentFourthResult').innerHTML = winMessage;
            break;
        case 5:
            document.querySelector('.opponentFifthResult').innerHTML = winMessage;
            break;
    }
}
            
            
            .inputUserName{
    text-align:center;
}

.messageWindow{
    display: none;/*メッセージが表示される部分は最初非表示とし、
                    名前入力後表示する*/
}

.battleWindow{
    display: none;/*2段落目と3段落目は最初非表示とし、
                    名前入力後表示する*/
}

h5{
    font-size: 24px;
    margin: 0;
    text-align: center;/*テキストを中央寄せする*/
}

.selectCommand{
    display: grid;/*grid layoutを用いる*/
    grid-template-columns: 1fr 1fr 1fr;
    /*横幅全体を3分割する。fraction(分数)*/
    /*background: #ccc;*/
}

.guhParagraph{
    text-align:center;
}

.chokiParagraph{
    text-align:center;
}

.pahParagraph{
    text-align:center;
}

.resultTable{
    width: 70%;
    margin: auto;
}

table{
    table-layout: fixed;
}

td:first-child{
    width: 50px;
    height: 40px;
    text-align: center
}

td:nth-child(2){
    width: 200px;
    height: 40px;
    text-align: center
}

td:last-child{
    width:200px;
    height:40px;
    text-align: center
}
